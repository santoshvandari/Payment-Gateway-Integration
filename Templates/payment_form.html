{% extends 'base.html' %}

{% block title %}Payment Form - {{ payment_method|title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white text-center">
                <h5 class="mb-0">Processing Payment with {{ payment_method|title }}</h5>
            </div>
            <div class="card-body text-center">
                {% if payment_method == 'esewa' %}
                <!-- eSewa Demo Payment -->
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Demo Mode:</strong> This is a simulation for learning purposes. 
                    <br><small>In production, users would be redirected to real eSewa login page for authentication and payment.</small>
                </div>
                
                <div class="mb-3">
                    <p><strong>Order ID:</strong> {{ order.order_id }}</p>
                    <p><strong>Amount:</strong> Rs. {{ order.total_price }}</p>
                </div>
                
                <div class="esewa-demo-container" style="background: linear-gradient(135deg, #60BB46, #22c55e); padding: 2rem; border-radius: 10px; color: white; margin: 1rem 0;">
                    <h4><i class="fas fa-wallet"></i> eSewa Payment Gateway (Demo)</h4>
                    <p>In real production, this would redirect to:</p>
                    <ul class="text-start" style="list-style: none;">
                        <li>✓ eSewa login page</li>
                        <li>✓ User authentication</li>
                        <li>✓ Bank authorization</li>
                        <li>✓ Real money transfer</li>
                        <li>✓ Payment verification</li>
                    </ul>
                    
                    <div class="mt-3">
                        <a href="{% url 'esewa_success' %}?oid={{ order.order_id }}&amt={{ order.total_price }}&refId=DEMO{{ order.order_id }}" 
                           class="btn btn-light btn-lg me-2">
                            <i class="fas fa-check"></i> Simulate Successful Payment
                        </a>
                        <a href="{% url 'esewa_failure' %}" class="btn btn-outline-light">
                            <i class="fas fa-times"></i> Simulate Failed Payment
                        </a>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small>
                        <strong>For Production:</strong> Replace demo with actual eSewa merchant credentials and API integration.
                    </small>
                </div>
                
                <script>
                // Removed auto-redirect to make it more clear this is manual demo
                console.log("Demo mode: No auto-redirect. User must manually choose payment outcome.");
                </script>
                
                {% else %}
                <!-- Original payment form for other gateways -->
                <p class="text-muted">You will be redirected to {{ payment_method|title }} payment gateway...</p>
                
                <form action="{{ payment_url }}" method="POST" id="payment-form">
                    {% for key, value in payment_data.items %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endfor %}
                    
                    <div class="mb-3">
                        <p><strong>Order ID:</strong> {{ order.order_id }}</p>
                        <p><strong>Amount:</strong> Rs. {{ order.total_price }}</p>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg">
                        Continue to {{ payment_method|title }}
                    </button>
                </form>
                
                <script>
                // Auto-submit form after 3 seconds
                setTimeout(function() {
                    document.getElementById('payment-form').submit();
                }, 3000);
                </script>
                {% endif %}
                
                <div class="mt-3">
                    <a href="{% url 'order_checkout' order.id %}" class="btn btn-secondary">Cancel Payment</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
